<div class="container mt-3">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h5 class="m-0">{{ $t('guild.title') }}</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="d-flex align-items-center gap-3">
              <p class="mb-0" style="color: white">{{ $t('guild.description') }}</p>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="mostrarOffline"
                  v-model="mostrarOffline"
                  @change="obtenerUsuarios"
                />
                <label class="form-check-label" for="mostrarOffline" style="color: white">
                  {{ $t('guild.showOffline') }}
                </label>
              </div>
            </div>
            <button class="btn btn-primary" @click="obtenerUsuarios" :disabled="cargando">
              {{ cargando ? $t('guild.loading') : $t('guild.update') }}
            </button>
          </div>

          <div v-if="cargando" class="alert alert-info">{{ $t('guild.loading') }}</div>

          <div v-else-if="error" class="alert alert-danger">{{ error }}</div>

          <div v-else-if="usuarios.length === 0" class="alert alert-warning">
            No hay personajes disponibles
          </div>

          <div v-else>
            <div class="row mb-3">
              <div v-for="usuario in usuariosPaginados" :key="usuario.id" class="col-md-4 mb-3">
                <div class="card h-100">
                  <div class="card-body">
                    <div class="text-center mb-3 position-relative">
                      <img
                        :src="usuario.avatar"
                        :alt="usuario.name"
                        class="rounded-circle"
                        style="width: 100px; height: 100px; object-fit: cover"
                        @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Crect fill=\'%23ddd\' width=\'100\' height=\'100\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'%23999\' font-family=\'Arial\' font-size=\'12\'%3E100x100%3C/text%3E%3C/svg%3E'"
                      />
                      <span
                        class="badge position-absolute top-0 end-0"
                        :class="usuario.isOnline ? 'bg-success' : 'bg-secondary'"
                        style="margin-right: 10px"
                      >
                        {{ usuario.isOnline ? $t('guild.character.online') : $t('guild.character.offline') }}
                      </span>
                    </div>
                    <h6 class="card-title text-center">{{ usuario.name }}</h6>
                    <hr />
                    <p class="card-text mb-2">
                      <small class="text-muted"><strong>{{ $t('guild.stats.race') }}:</strong> {{ usuario.race }}</small>
                    </p>
                    <p class="card-text mb-2">
                      <small class="text-muted"><strong>{{ $t('guild.stats.class') }}:</strong> {{ usuario.class }}</small>
                    </p>
                    <p class="card-text mb-2">
                      <small class="text-muted"><strong>{{ $t('guild.stats.guild') }}:</strong> {{ usuario.guild }}</small>
                    </p>
                    <p class="card-text mb-2">
                      <small class="text-muted"
                        ><strong>{{ $t('guild.stats.hp') }}:</strong>
                        <span
                          class="badge"
                          :class="usuario.hp > 50 ? 'bg-success' : usuario.hp > 20 ? 'bg-warning' : 'bg-danger'"
                        >
                          {{ usuario.hp }}
                        </span>
                      </small>
                    </p>
                    <p class="card-text mb-2">
                      <small class="text-muted"
                        ><strong>{{ $t('guild.stats.kingdom') }}:</strong> {{ usuario.kingdom }}</small
                      >
                    </p>
                    <p class="card-text">
                      <!-- <small class="text-muted"><strong>ID:</strong> {{ usuario.id }}</small>-->
                    </p>
                    <div class="d-flex justify-content-between gap-2 mt-3">
                      <button
                        class="btn btn-info btn-sm flex-fill"
                        @click="mostrarMasInfo(usuario)"
                      >
                        {{ $t('guild.actions.moreInfo') }}
                      </button>
                      <button
                        class="btn btn-warning btn-sm flex-fill"
                        @click="editarUsuario(usuario)"
                      >
                        {{ $t('guild.actions.edit') }}
                      </button>
                      <button
                        class="btn btn-danger btn-sm flex-fill"
                        @click="borrarUsuario(usuario.id)"
                      >
                        {{ $t('guild.actions.delete') }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Controles de paginación -->
            <nav v-if="totalPaginas > 1" :aria-label="$t('guild.pagination.label')">
              <ul class="pagination justify-content-center">
                <li class="page-item" :class="{ disabled: paginaActual === 1 }">
                  <a class="page-link" href="#" @click.prevent="paginaAnterior">{{ $t('guild.pagination.previous') }}</a>
                </li>
                <li
                  v-for="pagina in totalPaginas"
                  :key="pagina"
                  class="page-item"
                  :class="{ active: pagina === paginaActual }"
                >
                  <a class="page-link" href="#" @click.prevent="irAPagina(pagina)">{{ pagina }}</a>
                </li>
                <li class="page-item" :class="{ disabled: paginaActual === totalPaginas }">
                  <a class="page-link" href="#" @click.prevent="paginaSiguiente">{{ $t('guild.pagination.next') }}</a>
                </li>
              </ul>
            </nav>

            <!-- Información de paginación -->
            <div class="text-center mt-3">
              <small class="text-muted">
                {{ $t('guild.pagination.showing', { 
                  start: (paginaActual - 1) * usuariosPorPagina + 1,
                  end: Math.min(paginaActual * usuariosPorPagina, usuarios.length),
                  total: usuarios.length 
                }) }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
